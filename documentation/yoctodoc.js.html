<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>yoctodoc.js - yocto-doc</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css"/>
    <link type="text/css" rel="stylesheet" href="styles/tomorrow-night.min.css"/>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a><span class="version">v2.0.0</span></h2><h3>Modules</h3><ul><li><a href="module-main.html">main</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">yoctodoc.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

var _         = require('lodash');
var hooker    = require('hooker');
var glob      = require('glob');

/**
 * Default export for grunt yocto-doc-plugin
 *
 * @module main
 */
module.exports = function (grunt) {
  // default config path value
  var configPath    = [ __dirname, 'yoctodoc.json' ].join('/');

  // default config option to use on build process
  var defaultOptions = {
    jsdoc : {
      dist : {
        options : {
          destination : [ process.cwd(), 'documentation' ].join('/'),
          configure   : configPath,
          template    : [
            process.cwd(),
            'node_modules',
            'postman-jsdoc-theme',
          ].join('/'),
          readme      : [ process.cwd(), 'README.md' ].join('/')
        },
        src     : []
      }
    }
  };

  // Append default options to grunt config
  grunt.config.set('jsdoc', defaultOptions.jsdoc);

  // Register runner tasks
  grunt.registerTask('yoctodoc:runner', 'Documentation runner', function () {
    // Current internal Task
    var currentTask;

    // Filte task to get correct task to process.
    // Keep safe all other task in grunt config
    var tasks = _.filter(Object.keys(grunt.config.data), function (key) {
      return key === 'jsdoc';
    });

    // Hook grunt task execution
    hooker.hook(grunt.task, 'runTaskFn', {
      pre : function (context) {
        if (currentTask !== undefined) {
          currentTask = true; // true indicates the task has finished successfully.
        }
        currentTask = context.nameArgs;
      }
    });

    // Hook into the success / fail writer.
    hooker.hook(grunt.log.writeln(), [ 'success', 'fail' ], function (res) {
      // check done or aborted
      var done    = res === 'Done, without errors.' || 'Done.';
      var warning = res === 'Done, but with warnings.';
      var aborted = res === 'Aborted due to warnings.';
      var error   = warning || aborted;

      // Is finish ??
      if (done || error) {
        if (currentTask !== undefined) {
          currentTask = error ? false : true;

          // define default message
          var cMsg = {
            level : error ? 'warn' : 'ok',
            msg   : error ?
              'Documentation was not properly generated.' :
              'Documentation was generated properly.'
          };

          // only if all is done
          if (done) {
            // copy custom css to dest file
            grunt.file.copy(
              [ process.cwd(), 'tasks/css/custom.css' ].join('/'),
              [ grunt.config.data.jsdoc.dist.options.destination, 'styles/custom.css' ].join('/'));
            // copy custom css to dest file
            grunt.file.copy([ process.cwd(), 'node_modules/color-themes-for-google-code-prettify',
              'dist/themes/tomorrow-night-bright.css'
            ].join('/'), [
              grunt.config.data.jsdoc.dist.options.destination, 'styles/tomorrow-night.min.css'
            ].join('/'));
            // parse all template to set properly the current header name
            var templates = glob.sync([
              grunt.config.data.jsdoc.dist.options.destination,
              '*.html'
            ].join('/'));
            // current date
            var date = new Date();

            // info message
            grunt.log.ok('Updating each page with custom value. please wait ...');

            // get config used
            var configUsed = JSON.parse(grunt.file.read(configPath));
            // parse all files
            _.each(templates, function (t) {
              // get content to process replace
              var content = grunt.file.read(t);
              // process default replacement
              content = content.replace(/(&lt;title>)(.*\- )(.*)(&lt;\/title>)/gi, [
                  '$1$2', grunt.config.data.pkg.name,'$4'
                ].join(''))
                .replace(/(&lt;\/head>)/gi, [ _.repeat(' ', 4),
                '&lt;link type="text/css" rel="stylesheet" href="styles/custom.css"/>\n$1' ].join(''))
                .replace(/(&lt;\/head>)/gi, [ _.repeat(' ', 4),
                '&lt;link type="text/css" rel="stylesheet" href="styles/tomorrow-night.min.css"/>\n$1'
                ].join(''))
                .replace(/(&lt;footer>)(.*\n.*\n)(&lt;\/footer>)/gi, [ '$1',
                  configUsed.opts.footer.replace('%date%', date)
                                        .replace('%appname%', grunt.config.data.pkg.name)
                                        .replace('%year%', date.getFullYear()), '$3' ].join(''))
                .replace(/(&lt;nav>\n.*&lt;h2>)(.*)(&lt;\/h2>)/gi, [ '$1$2&lt;span class="version">',
                    [ 'v', grunt.config.data.pkg.version ].join(''), '&lt;/span>$3'].join(''));

              // rewrite file with correct name
              grunt.file.write(t, content);
            });
          }
          // Need to log end message with custom param
          grunt.log[cMsg.level](cMsg.msg);
        }
      }
    });

    // Run each given task
    _.each(tasks, function (task) {
      grunt.task.run(task);
    });
  });

  // Register default plugin process
  grunt.registerMultiTask('yoctodoc', 'Generate js documention from JsDoc', function () {
    // retrive options
    var options = this.options();

    // check if jshint option is given
    if (!_.isUndefined(options.destination) &amp;&amp; !_.isNull(options.destination) &amp;&amp;
      _.isString(options.destination) &amp;&amp; !_.isEmpty(options.destination)) {

      // Log message and merge options
      grunt.log.ok('New destination options given for yoctodoc. Processing update.');
      defaultOptions.jsdoc.dist.options.destination = options.destination;
      grunt.log.ok([ 'New destination added :',
        defaultOptions.jsdoc.dist.options.destination
      ].join(' '));
    }

    // Filter file and return correct file path
    this.data = this.filesSrc.map(function (filepath) {
      // exists ?
      if (!grunt.file.exists(filepath)) {
        grunt.log.warn([ 'Source file "', filepath, '" not found.' ].join(''));

        // bash value retutning false
        return false;
      }
      // return file path
      return filepath;
    });

    // Has data ?
    if (!_.isEmpty(this.data)) {
      // notify console
      grunt.log.ok([
        this.data.length,
        [ 'file', (this.data.length > 1 ? 's' : '') ].join(''),
        'found. Adding on source list.'
      ].join(' '));

      // Assign default options to config file
      defaultOptions.jsdoc.dist.src = this.data;

      // Merge config data to grunt config
      grunt.config.merge('jsdoc', defaultOptions.jsdoc);

      // notif console
      grunt.log.ok('Processing yoctodoc:runner ...');

      // Run tasks
      grunt.task.run('yoctodoc:runner');
    } else {
      grunt.log.warn('No source given. Please check your Grunfile config for yoctodoc');
    }
  });

  // Load grunt needed task
  grunt.loadNpmTasks('grunt-jsdoc');
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>Documentation for application <b>yocto-doc<b> was generated at Fri Dec 02 2016 02:00:33 GMT+0400 (RET) with <a href='https://www.npmjs.com/package/yoctodoc'>yocto-doc</a> module - Copyright Yocto Â© 2016</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
